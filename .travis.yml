sudo: required

services:
    - docker

before_install:
    - curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
    - sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"
    - sudo apt-get update
    - sudo apt-get -y -o Dpkg::Options::="--force-confnew" install docker-ce nodejs npm
    - cp .env.travis .env
    - docker-compose build
    - docker-compose up -d
    - docker ps -a

install:
    - docker exec -it richwholesale.local composer install --no-interaction
    - docker exec -it richwholesale.local php artisan migrate:fresh --seed
    - docker exec -it richwholesale.local npm install
    - docker exec -it richwholesale.local npm run production

script:
    - docker exec -it richwholesale.local vendor/bin/phpunit

notifications:
    email: false
